const applyDatoraDiscount = async function() {
  const datoraInput = document.querySelector('input[name="datora-discount"][form="datora-form"]') || 
                     document.querySelector('input[name="datora-discount"]');
  
  if(!datoraInput) return;

  const discountCode = datoraInput.value.trim();
  const datoraContainer = datoraInput.closest('.datora-discount-field-container');

  if(discountCode.length < 1) {
    return;
  }

  if(datoraContainer) datoraContainer.classList.add('loading');
  
  if (typeof co2 !== 'undefined' && typeof co2.setDiscountCode === 'function') {
    var resultChangeDiscountCode = await co2.setDiscountCode(discountCode);
    if(resultChangeDiscountCode){
      if(datoraContainer) datoraContainer.classList.add('done').remove('error', 'loading');
      document.documentElement.dispatchEvent(new CustomEvent('cart:refresh', { bubbles: true }));
    } else {
      if(datoraContainer) datoraContainer.classList.add('error').remove('done', 'loading');
    }
  }
};